(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=React;var r=e.n(t);const n=ReactDOM;var a=e.n(n);const o=RChainToken;var s=new Intl.NumberFormat("en-US",{maximumFractionDigits:8});function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function p(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(y,e);var t,n,a,o,i=(a=y,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(a);if(o){var r=m(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return p(this,e)});function y(){var e;c(this,y);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return f(d(e=i.call.apply(i,[this].concat(r))),"state",{title:"Help me buy a sword !",description:"",price:1e8,quantity:1e3}),e}return t=y,(n=[{key:"render",value:function(){var e=this;return r().createElement("div",{className:"genesis-form form"},r().createElement("div",{id:"canvas"}),r().createElement("p",null,"Hi ! The tipping board has not been initialized yet. Choose a price per token, choose the quantity of tokens you want to create. And eventually title and description.",r().createElement("br",null),r().createElement("br",null),"By default one token equals one REV and 1000 tokens are created for the tip board. Fill free to change the values. Remember that 1 REV equals 100.000.000 dusts.",r().createElement("br",null),r().createElement("br",null)),r().createElement("div",{className:"field"},r().createElement("label",{className:"label"},"Title"),r().createElement("div",{className:"control"},r().createElement("input",{defaultValue:this.state.title,onInput:function(t){return e.setState({title:t.target.value})},className:"input",type:"text"}))),r().createElement("div",{className:"field"},r().createElement("label",{className:"label"},"Description"),r().createElement("div",{className:"control"},r().createElement("textarea",{className:"textarea",onInput:function(t){e.setState({description:t.target.value})},defaultValue:this.state.description}))),r().createElement("div",{className:"field"},r().createElement("label",{className:"label"},"Price for each token (dust)"),r().createElement("div",{className:"control"},r().createElement("input",{defaultValue:this.state.price,onInput:function(t){return e.setState({price:parseInt(t.target.value)})},className:"input",type:"number",min:1,step:1}))),r().createElement("div",{className:"field"},r().createElement("label",{className:"label"},"Quantity of tokens"),r().createElement("div",{className:"control"},r().createElement("input",{defaultValue:this.state.quantity,onChange:function(t){return e.setState({quantity:parseInt(t.target.value)})},className:"input",type:"number",min:1,step:1})),this.state&&this.state.price&&this.state.quantity&&this.state.title?r().createElement("p",null,"Total REV :"," ",s.format(this.state.price*this.state.quantity/1e8)," ",r().createElement("br",null),"Total dust (1 REV equals 100.000.000 dust):"," ",s.format(this.state.price*this.state.quantity)," "):void 0),r().createElement("div",{className:"field"},r().createElement("br",null),r().createElement("button",{className:"button is-light",disabled:!(this.state&&this.state.price&&this.state.quantity&&this.state.title),type:"button",onClick:function(t){e.state&&e.state.price&&e.state.quantity&&e.state.title&&e.props.onValuesChosen({price:e.state.price,quantity:e.state.quantity,title:e.state.title,description:e.state.description})}},"Save values and create tipping board !")))}}])&&l(t.prototype,n),y}(r().Component);function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}function E(e,t){if(t&&("object"===h(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}var N=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(c,e);var t,n,a,o,i=(a=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=g(a);if(o){var r=g(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return E(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=i.call(this,e)).state={quantity:0,name:"",emoji:void 0,displayEmojis:!1},t}return t=c,(n=[{key:"render",value:function(){for(var e=this,t=this.props.purses[this.props.purseToPurchaseFrom],n=JSON.parse(decodeURI(this.props.pursesData[this.props.purseForData])),a=!t||0===t.quantity,o=Object.keys(this.props.purses).filter((function(e){return"1"!==e&&"2"!==e})).sort((function(e,t){return parseInt(e)<parseInt(t)?1:-1})),i=Object.keys(this.props.purses),c=0,l=1;l<i.length;l+=1)"1"!==i[l]&&"2"!==i[l]&&"0"===this.props.purses[i[l]].type&&(c+=this.props.purses[i[l]].quantity);var u=n.quantity;return r().createElement("div",{className:"tip-board"},r().createElement("h3",{className:"title is-3"},this.props.values.title),r().createElement("span",{className:"link"},"tips?master=",this.props.masterRegistryUri,"&contract=",this.props.contractId),this.props.values.description&&r().createElement("p",{className:"description"},this.props.values.description),a&&r().createElement("p",null,"All tokens are sold !"),r().createElement("p",null,c," out of ",u," tokens sold (",Math.round(100*c/u),"%)"),r().createElement("p",null,t?r().createElement("span",null,t.quantity," tokens are for sale at a price of"," ",s.format(t.price/1e8)," REV per token"):void 0),r().createElement("br",null),!a&&r().createElement("div",{className:"contribution-form"},r().createElement("div",{className:"cell-form"},r().createElement("div",{className:"field"},r().createElement("label",{className:"label"},"Quantity to purchase"),r().createElement("div",{className:"control"},r().createElement("input",{defaultValue:this.state.quantity,onInput:function(t){return e.setState({quantity:parseInt(t.target.value)})},className:"input",type:"number",min:1,step:1,max:this.props.max}))),r().createElement("div",{className:"field"},r().createElement("label",{className:"label"},"Name"),r().createElement("div",{className:"control"},r().createElement("input",{defaultValue:this.state.name,onInput:function(t){return e.setState({name:t.target.value})},className:"input",type:"text"}),this.state.emoji?r().createElement("span",{className:"label-emoji"},this.state.emoji):void 0)),r().createElement("div",{className:"field"},r().createElement("label",{className:"label"},"Contribution price"),r().createElement("div",null,r().createElement("span",{className:"total-price"},r().createElement("b",null,s.format(this.state.quantity*t.price/1e8))," REV"),r().createElement("br",null),this.state.quantity*t.price<1e8&&r().createElement("span",{className:"total-price"},r().createElement("b",null,s.format(this.state.quantity*t.price))," dusts"))),r().createElement("div",{className:"field"},r().createElement("br",null),r().createElement("button",{className:"button is-light",disabled:!this.state.quantity,type:"button",onClick:function(t){var r={name:e.state.name};e.state.emoji&&(r.emoji=e.state.emoji),r=encodeURI(JSON.stringify(r)),e.state.quantity&&e.props.onPurchase({quantity:e.state.quantity,data:r})}},"Tip !")))),r().createElement("div",{className:"tips"},r().createElement("p",null,o.length," contributions :"),o.map((function(t){var a;try{a=JSON.parse(decodeURI(e.props.pursesData[t]))}catch(e){return console.log(e),r().createElement("p",{key:t,className:""},"Unable to parse")}return r().createElement("p",{key:t},r().createElement("b",{className:"name"},e.props.pursesData[t]?a.name:"Anonymous")," ",r().createElement("span",null,"tipped"),r().createElement("b",{className:"amount"},s.format(e.props.purses[t].quantity*n.price/1e8)," ","REV"))}))))}}])&&b(t.prototype,n),c}(r().Component);function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function O(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function S(e,t){return S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},S(e,t)}function w(e,t){if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return k(e)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(c,e);var t,n,a,s,i=(a=c,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=I(a);if(s){var r=I(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return w(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),j(k(t=i.call(this,e)),"onValuesChosen",(function(e){var r,n;if(t.setState({deploying:1}),"undefined"!=typeof dappyRChain){var a={masterRegistryUri:t.props.masterRegistryUri,contractId:t.props.contractId,boxId:t.props.box,purses:(r={},j(r,"1",{id:"",boxId:t.props.box,quantity:e.quantity,price:e.price}),j(r,"2",{id:"",boxId:t.props.box,quantity:1,price:null}),r),data:(n={},j(n,"1",null),j(n,"2",encodeURI(JSON.stringify({title:e.title,description:e.description,price:e.price,quantity:e.quantity}))),n)},s=(0,o.createPursesTerm)(a);dappyRChain.transaction({term:s,signatures:{}}).then((function(e){t.setState({deploying:2}),new Promise((function(e,t){setInterval((function(){var t=dappyStore.getState().transactions,r=Object.keys(t);r.length&&(r.find((function(e){return t[e].value&&"completed"===t[e].value.status}))?e(t[r[0]].value):console.log("result from deploy not found yet"))}),4e3)})).then((function(e){t.setState({modal:"values-chosen",deploying:void 0})}))}))}else console.warn("window.dappyRChain is undefined, cannot deploy rchain-token")})),j(k(t),"onPurchase",(function(e){dappyRChain.transaction({term:(0,o.purchaseTerm)({masterRegistryUri:t.props.masterRegistryUri,contractId:t.props.contractId,purseId:t.props.purseToPurchaseFrom,boxId:["BOX_","ID"].join(""),quantity:e.quantity,data:e.data,merge:!1,newId:"",price:t.props.purses[t.props.purseToPurchaseFrom].price,publicKey:["PUBLIC","_KEY"].join("")}),signatures:{}}).then((function(e){t.setState({modal:"purchase"})}))})),t.state={modal:void 0,purses:void 0,pursesData:void 0},t}return t=c,(n=[{key:"componentDidMount",value:function(){var e=this;console.log("did mount"),console.log(this.props),this.props.purses&&setInterval((function(){dappyRChain.exploreDeploys([(0,o.readAllPursesTerm)({masterRegistryUri:e.props.masterRegistryUri,contractId:e.props.contractId,depth:2})]).then((function(t){var r=JSON.parse(t).results,n=JSON.parse(r[0].data).expr[0],a=(0,o.decodePurses)(n,blockchainUtils.rhoExprToVar,blockchainUtils.decodePar);console.log("App purses",a),dappyRChain.exploreDeploys([(0,o.readPursesDataTerm)({masterRegistryUri:e.props.masterRegistryUri,contractId:e.props.contractId,pursesIds:Object.keys(a)})]).then((function(t){var r=JSON.parse(t).results,n={},o=JSON.parse(r[0].data).expr[0];o&&(n=blockchainUtils.rhoValToJs(o)),console.log("App pursesData",n),e.setState({purses:a,pursesData:n})}))}))}),15e3)}},{key:"render",value:function(){var e=this;return this.state.deploying?r().createElement("div",null,r().createElement("p",null,r().createElement("br",null),r().createElement("br",null),r().createElement("br",null),r().createElement("br",null),"Now deploying contracts (",this.state.deploying,"/3), please do not refresh or close tab")):"purchase"===this.state.modal?r().createElement("div",{className:"modal"},r().createElement("div",{className:"modal-background"}),r().createElement("div",{className:"modal-card"},r().createElement("header",{className:"modal-card-head"},r().createElement("p",{className:"modal-card-title"},"Purchase successful"),r().createElement("button",{onClick:function(){return e.setState({modal:void 0})},className:"delete","aria-label":"close"})),r().createElement("section",{className:"modal-card-body"},"Transaction was successfully sent. Wait few minutes and you should see your contribution."),r().createElement("footer",{className:"modal-card-foot"},r().createElement("button",{onClick:function(){return e.setState({modal:void 0})},class:"button"},"Ok")))):"values-chosen"===this.state.modal?r().createElement("div",{className:"modal"},r().createElement("div",{className:"modal-background"}),r().createElement("div",{className:"modal-card"},r().createElement("header",{className:"modal-card-head"},r().createElement("p",{className:"modal-card-title"},"Submit successful"),r().createElement("button",{onClick:function(){return e.setState({modal:void 0})},className:"delete","aria-label":"close"})),r().createElement("section",{className:"modal-card-body"},"Submit was successful, wait few minutes, reload, and the rchain-token contract should be initiated."),r().createElement("footer",{className:"modal-card-foot"},r().createElement("button",{onClick:function(){return e.setState({modal:void 0})},class:"button"},"Ok")))):this.props.values?r().createElement(N,{masterRegistryUri:this.props.masterRegistryUri,purseToPurchaseFrom:this.props.purseToPurchaseFrom,purseForData:this.props.purseForData,contractId:this.props.contractId,onPurchase:this.onPurchase,values:this.props.values,emojis:this.props.emojis,pursesData:this.state.pursesData||this.props.pursesData,purses:this.state.purses||this.props.purses}):r().createElement(y,{onValuesChosen:this.onValuesChosen})}}])&&O(t.prototype,n),c}(r().Component),T="14.0.0",x="qxxunjju9rn51ehaus6se3td4gotyozw1zaykzjak749pbpjgocy97",q=function(e){var t=document.createElement("p");t.style.color="#B22",t.style.fontWeight="400",t.style.fontSize="1.8rem",t.innerText=e;var r=document.createElement("p");r.innerText="URL should have the following structure : tips?contract=myftcontract\n\nIf you are using tips on a secondary network, also reference the master registry uri &master=aaabbb",r.style.color="#B22",r.style.fontWeight="400",r.style.fontSize="1.1rem",r.style.paddingTop="10px",document.body.innerHTML="",document.body.style.background="#111",document.body.style.padding="20px",document.body.appendChild(t),document.body.appendChild(r)};document.addEventListener("DOMContentLoaded",(function(){if("undefined"!=typeof dappyRChain){var e,t=new URLSearchParams(window.location.search);t.get("master")?(console.log("found master registry URI in parameters",t.get("master")),e=t.get("master")):(console.log("picking default mainnet / d network master registry URI",x),e=x);var n=t.get("contract");if(!n||0===n.length)return void q("did not find contract id in parameters ?contract=x, length must be 54");if(!e||54!==e.length)return void q("master registry URI is incorrect ?master=x, length must be 54");dappyRChain.exploreDeploys([(0,o.readConfigTerm)({masterRegistryUri:e,contractId:n}),(0,o.readAllPursesTerm)({masterRegistryUri:e,contractId:n,depth:2}),(0,o.readPursesDataTerm)({masterRegistryUri:e,pursesIds:["2","1"],contractId:n})]).then((function(t){var s=JSON.parse(t).results,i=JSON.parse(s[0].data).expr[0],c=JSON.parse(s[1].data).expr[0],l=JSON.parse(s[2].data).expr[0];if(i){var u,p=blockchainUtils.rhoValToJs(i),d={};if(c&&(d=(0,o.decodePurses)(c,blockchainUtils.rhoExprToVar,blockchainUtils.decodePar)),l&&(u=blockchainUtils.rhoValToJs(l)),!0===p.fungible)if(p.version===T){var m=Object.keys(d),f=void 0;if(m.includes("1")&&u[1]?f="1":m.includes("2")&&u[2]&&(f="2"),"string"==typeof f){var y=["1","2"].find((function(e){return"number"==typeof d[e].price})),h=JSON.parse(decodeURI(u[f]));if(document.title=h.title,"number"!=typeof h.price||"number"!=typeof h.quantity||"string"!=typeof h.description||"string"!=typeof h.title)return void q("values must have title, description, price and quantity");dappyRChain.exploreDeploys([(0,o.readPursesDataTerm)({masterRegistryUri:e,contractId:n,pursesIds:m.slice(0,100)})]).then((function(t){var o=JSON.parse(t).results,s={},i=JSON.parse(o[0].data).expr[0];i&&(s=blockchainUtils.rhoValToJs(i)),document.getElementById("root").setAttribute("class","loaded"),a().render(r().createElement(P,{masterRegistryUri:e,contractId:n,values:h,purseToPurchaseFrom:y,purseForData:"1"===y?"2":"1",purses:d,pursesData:s}),document.getElementById("root"))})).catch((function(e){console.log(e)}))}else dappyRChain.identify({publicKey:void 0}).then((function(t){if(t.identified){if(!t.box)return void q("Need a box for identification, please associate a token box to your account");document.getElementById("root").setAttribute("class","loaded"),a().render(r().createElement(P,{masterRegistryUri:e,contractId:n,publicKey:t.publicKey,box:t.box,values:void 0,bags:void 0,bagsData:void 0}),document.getElementById("root"))}else q("This dapp needs identification"),console.error("This dapp needs identification")})).catch((function(e){console.log(e),q("This dapp needs identification"),console.error("This dapp needs identification")}))}else q("Version should be ".concat(T));else q("This contract is fungible=false (NFT), you need a fungible=true (FT) contract to use tips")}else q("Contract not found, are you sure contract ".concat(n," exists ?"))})).catch((function(e){console.log(e),q("Unknown error"),console.error("error")}))}}))})();