!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=3)}([function(e,t){e.exports=React},function(e,t){e.exports=RChainToken},function(e,t){e.exports=ReactDOM},function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(2),s=a.n(o),i=a(1),c=new Intl.NumberFormat("en-US",{maximumFractionDigits:8});function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=b(e);if(t){var r=b(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f(this,a)}}function f(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?y(e):t}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(s,e);var t,a,n,o=m(s);function s(){var e;u(this,s);for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return h(y(e=o.call.apply(o,[this].concat(a))),"state",{title:"Help me buy a sword !",description:"",price:1e8,quantity:1e3}),e}return t=s,(a=[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"genesis-form form"},r.a.createElement("div",{id:"canvas"}),r.a.createElement("p",null,"Hi ! The tipping board has not been initialized yet. Choose a price per token, choose the quantity of tokens you want to create. And eventually title and description.",r.a.createElement("br",null),r.a.createElement("br",null),"By default one token equals one REV and 1000 tokens are created for the tip board. Fill free to change the values. Remember that 1 REV equals 100.000.000 dusts.",r.a.createElement("br",null),r.a.createElement("br",null)),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Title"),r.a.createElement("div",{className:"control"},r.a.createElement("input",{defaultValue:this.state.title,onInput:function(t){return e.setState({title:t.target.value})},className:"input",type:"text"}))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Description"),r.a.createElement("div",{className:"control"},r.a.createElement("textarea",{className:"textarea",onInput:function(t){e.setState({description:t.target.value})},defaultValue:this.state.description}))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Price for each token (dust)"),r.a.createElement("div",{className:"control"},r.a.createElement("input",{defaultValue:this.state.price,onInput:function(t){return e.setState({price:parseInt(t.target.value)})},className:"input",type:"number",min:1,step:1}))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Quantity of tokens"),r.a.createElement("div",{className:"control"},r.a.createElement("input",{defaultValue:this.state.quantity,onChange:function(t){return e.setState({quantity:parseInt(t.target.value)})},className:"input",type:"number",min:1,step:1})),this.state&&this.state.price&&this.state.quantity&&this.state.title?r.a.createElement("p",null,"Total REV :"," ",c.format(this.state.price*this.state.quantity/1e8)," ",r.a.createElement("br",null),"Total dust (1 REV equals 100.000.000 dust):"," ",c.format(this.state.price*this.state.quantity)," "):void 0),r.a.createElement("div",{className:"field"},r.a.createElement("br",null),r.a.createElement("button",{className:"button is-light",disabled:!(this.state&&this.state.price&&this.state.quantity&&this.state.title),type:"button",onClick:function(t){e.state&&e.state.price&&e.state.quantity&&e.state.title&&e.props.onValuesChosen({price:e.state.price,quantity:e.state.quantity,title:e.state.title,description:e.state.description})}},"Save values and create tipping board !")))}}])&&p(t.prototype,a),n&&p(t,n),s}(r.a.Component);function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=S(e);if(t){var r=S(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return R(this,a)}}function R(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var j=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(s,e);var t,a,n,o=O(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).state={quantity:0,name:"",emoji:void 0,displayEmojis:!1},t}return t=s,(a=[{key:"render",value:function(){for(var e=this,t=this.props.purses[1],a=JSON.parse(decodeURI(this.props.pursesData[2])),n=!t||0===t.quantity,o=Object.keys(this.props.purses).filter((function(e){return"1"!==e&&"2"!==e})).sort((function(e,t){return parseInt(e)<parseInt(t)?1:-1})),s=Object.keys(this.props.purses),i=0,l=1;l<s.length;l+=1)"1"!==s[l]&&"2"!==s[l]&&"0"===this.props.purses[s[l]].type&&(i+=this.props.purses[s[l]].quantity);var u=a.quantity;return r.a.createElement("div",{className:"tip-board"},r.a.createElement("h3",{className:"title is-3"},this.props.values.title),r.a.createElement("span",{className:"link"},"tipboard?master=",this.props.masterRegistryUri,"&contract=",this.props.contractId),this.props.values.description&&r.a.createElement("p",{className:"description"},this.props.values.description),n&&r.a.createElement("p",null,"All tokens are sold !"),r.a.createElement("p",null,i," out of ",u," tokens sold (",Math.round(100*i/u),"%)"),r.a.createElement("p",null,t?r.a.createElement("span",null,t.quantity," tokens are for sale at a price of"," ",c.format(t.price/1e8)," REV per token"):void 0),r.a.createElement("br",null),!n&&r.a.createElement("div",{className:"contribution-form"},r.a.createElement("div",{className:"cell-form"},r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Quantity to purchase"),r.a.createElement("div",{className:"control"},r.a.createElement("input",{defaultValue:this.state.quantity,onInput:function(t){return e.setState({quantity:parseInt(t.target.value)})},className:"input",type:"number",min:1,step:1,max:this.props.max}))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Name"),r.a.createElement("div",{className:"control"},r.a.createElement("input",{defaultValue:this.state.name,onInput:function(t){return e.setState({name:t.target.value})},className:"input",type:"text"}),this.state.emoji?r.a.createElement("span",{className:"label-emoji"},this.state.emoji):void 0)),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Contribution price"),r.a.createElement("div",null,r.a.createElement("span",{className:"total-price"},r.a.createElement("b",null,c.format(this.state.quantity*t.price/1e8))," REV"),r.a.createElement("br",null),this.state.quantity*t.price<1e8&&r.a.createElement("span",{className:"total-price"},r.a.createElement("b",null,c.format(this.state.quantity*t.price))," dusts"))),r.a.createElement("div",{className:"field"},r.a.createElement("br",null),r.a.createElement("button",{className:"button is-light",disabled:!this.state.quantity,type:"button",onClick:function(t){var a={name:e.state.name};e.state.emoji&&(a.emoji=e.state.emoji),a=encodeURI(JSON.stringify(a)),e.state.quantity&&e.props.onPurchase({quantity:e.state.quantity,data:a})}},"Tip !")))),r.a.createElement("div",{className:"tips"},r.a.createElement("p",null,o.length," contributions :"),o.map((function(t){var n;try{n=JSON.parse(decodeURI(e.props.pursesData[t]))}catch(e){return console.log(e),r.a.createElement("p",{key:t,className:""},"Unable to parse")}return r.a.createElement("p",{key:t},r.a.createElement("b",{className:"name"},e.props.pursesData[t]?n.name:"Anonymous")," ",r.a.createElement("span",null,"tipped"),r.a.createElement("b",{className:"amount"},c.format(e.props.purses[t].quantity*a.price/1e8)," ","REV"))}))))}}])&&E(t.prototype,a),n&&E(t,n),s}(r.a.Component);function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=U(e);if(t){var r=U(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return P(this,a)}}function P(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?T(e):t}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(s,e);var t,a,n,o=k(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),q(T(t=o.call(this,e)),"onValuesChosen",(function(e){var a,n;if(t.setState({deploying:1}),"undefined"!=typeof dappyRChain){var r={masterRegistryUri:t.props.masterRegistryUri,contractId:t.props.contractId,boxId:t.props.box,purses:(a={},q(a,"1",{id:"",boxId:t.props.box,type:"0",quantity:e.quantity,price:e.price}),q(a,"2",{id:"",boxId:t.props.box,type:"data",quantity:1,price:null}),a),data:(n={},q(n,"1",null),q(n,"2",encodeURI(JSON.stringify({title:e.title,description:e.description,price:e.price,quantity:e.quantity}))),n)},o=Object(i.createPursesTerm)(r);dappyRChain.transaction({term:o,signatures:{}}).then((function(e){t.setState({deploying:2}),new Promise((function(e,t){setInterval((function(){var t=dappyStore.getState().transactions,a=Object.keys(t);a.length&&(a.find((function(e){return t[e].value&&"completed"===t[e].value.status}))?e(t[a[0]].value):console.log("result from deploy not found yet"))}),4e3)})).then((function(e){t.setState({modal:"values-chosen",deploying:void 0})}))}))}else console.warn("window.dappyRChain is undefined, cannot deploy rchain-token")})),q(T(t),"onPurchase",(function(e){dappyRChain.transaction({term:Object(i.purchaseTerm)({masterRegistryUri:t.props.masterRegistryUri,contractId:t.props.contractId,purseId:"1",boxId:["TO_BOX_REGI","STRY_URI"].join(""),quantity:e.quantity,data:e.data,merge:!1,newId:"",price:t.props.purses[1].price,publicKey:["PUBLIC","_KEY"].join("")}),signatures:{}}).then((function(e){t.setState({modal:"purchase"})}))})),t.state={modal:void 0,purses:void 0,pursesData:void 0},t}return t=s,(a=[{key:"componentDidMount",value:function(){var e=this;this.props.purses&&setInterval((function(){dappyRChain.exploreDeploys([Object(i.readAllPursesTerm)({masterRegistryUri:e.props.masterRegistryUri,contractId:e.props.contractId})]).then((function(t){var a=JSON.parse(t).results,n=JSON.parse(a[0].data).expr[0],r=Object(i.decodePurses)(n,blockchainUtils.rhoExprToVar,blockchainUtils.decodePar);dappyRChain.exploreDeploys([Object(i.readPursesDataTerm)({masterRegistryUri:e.props.masterRegistryUri,contractId:e.props.contractId,pursesIds:Object.keys(r)})]).then((function(t){var a=JSON.parse(t).results,n={},o=JSON.parse(a[0].data).expr[0];o&&(n=blockchainUtils.rhoValToJs(o)),e.setState({purses:r,pursesData:n})}))}))}),15e3)}},{key:"render",value:function(){var e=this;return this.state.deploying?r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),"Now deploying contracts (",this.state.deploying,"/3), please do not refresh or close tab")):"purchase"===this.state.modal?r.a.createElement("div",{className:"modal"},r.a.createElement("div",{className:"modal-background"}),r.a.createElement("div",{className:"modal-card"},r.a.createElement("header",{className:"modal-card-head"},r.a.createElement("p",{className:"modal-card-title"},"Purchase successful"),r.a.createElement("button",{onClick:function(){return e.setState({modal:void 0})},className:"delete","aria-label":"close"})),r.a.createElement("section",{className:"modal-card-body"},"Transaction was successfully sent. Wait few minutes and you should see your contribution."),r.a.createElement("footer",{className:"modal-card-foot"},r.a.createElement("button",{onClick:function(){return e.setState({modal:void 0})},class:"button"},"Ok")))):"values-chosen"===this.state.modal?r.a.createElement("div",{className:"modal"},r.a.createElement("div",{className:"modal-background"}),r.a.createElement("div",{className:"modal-card"},r.a.createElement("header",{className:"modal-card-head"},r.a.createElement("p",{className:"modal-card-title"},"Submit successful"),r.a.createElement("button",{onClick:function(){return e.setState({modal:void 0})},className:"delete","aria-label":"close"})),r.a.createElement("section",{className:"modal-card-body"},"Submit was successful, wait few minutes, reload, and the rchain-token contract should be initiated."),r.a.createElement("footer",{className:"modal-card-foot"},r.a.createElement("button",{onClick:function(){return e.setState({modal:void 0})},class:"button"},"Ok")))):this.props.values?r.a.createElement(j,{masterRegistryUri:this.props.masterRegistryUri,contractId:this.props.contractId,onPurchase:this.onPurchase,values:this.props.values,emojis:this.props.emojis,pursesData:this.state.pursesData||this.props.pursesData,purses:this.state.purses||this.props.purses}):r.a.createElement(v,{onValuesChosen:this.onValuesChosen})}}])&&w(t.prototype,a),n&&w(t,n),s}(r.a.Component),_=function(e){var t=document.createElement("p");t.style.color="#B22",t.style.fontWeight="400",t.style.fontSize="1.8rem",t.innerText=e;var a=document.createElement("p");a.innerText="URL should have the following structure : tipboard?contract=myftcontract\n\nIf you are using tipboard on a secondary network, also reference the master registry uri &master=aaabbb",a.style.color="#B22",a.style.fontWeight="400",a.style.fontSize="1.1rem",a.style.paddingTop="10px",document.body.innerHTML="",document.body.style.background="#111",document.body.style.padding="20px",document.body.appendChild(t),document.body.appendChild(a)};document.addEventListener("DOMContentLoaded",(function(){if("undefined"!=typeof dappyRChain){var e,t=new URLSearchParams(window.location.search);t.get("master")?(console.log("found master registry URI in parameters",t.get("master")),e=t.get("master")):(console.log("picking default mainnet / d network master registry URI","afjrah43mg5486tt4yweju9nshbhwhg9zumz4g4gxu4b8uwhced9gz"),e="afjrah43mg5486tt4yweju9nshbhwhg9zumz4g4gxu4b8uwhced9gz");var a=t.get("contract"),n=t.get("contract")||"index";if(!a||0===a.length)return void _("did not find contract id in parameters ?contract=x, length must be 54");if(!n||0===n.length)return void _("did not find purse id in parameters ?contract=x, length must be 54");if(!e||54!==e.length)return void _("master registry URI is incorrect ?master=x, length must be 54");dappyRChain.exploreDeploys([Object(i.readConfigTerm)({masterRegistryUri:e,contractId:a}),Object(i.readAllPursesTerm)({masterRegistryUri:e,contractId:a}),Object(i.readPursesDataTerm)({masterRegistryUri:e,pursesIds:["2"],contractId:a})]).then((function(t){var n,o=JSON.parse(t).results,c=blockchainUtils.rhoValToJs(JSON.parse(o[0].data).expr[0]),l=JSON.parse(o[1].data).expr[0],u=Object(i.decodePurses)(l,blockchainUtils.rhoExprToVar,blockchainUtils.decodePar);if(JSON.parse(o[2].data).expr[0]&&(n=blockchainUtils.rhoValToJs(JSON.parse(o[2].data).expr[0])),!0===c.fungible)if("6.0.0"===c.version){var p=Object.keys(u);if(p.includes("2")){var d=JSON.parse(decodeURI(n[2]));if(document.title=d.title,"number"!=typeof d.price||"number"!=typeof d.quantity||"string"!=typeof d.description||"string"!=typeof d.title)return void _("values must have title, description, price and quantity");dappyRChain.exploreDeploys([Object(i.readPursesDataTerm)({masterRegistryUri:e,contractId:a,pursesIds:p.slice(0,100)})]).then((function(t){var n=JSON.parse(t).results,o={},i=JSON.parse(n[0].data).expr[0];i&&(o=blockchainUtils.rhoValToJs(i)),document.getElementById("root").setAttribute("class","loaded"),s.a.render(r.a.createElement(C,{masterRegistryUri:e,contractId:a,values:d,purses:u,pursesData:o}),document.getElementById("root"))})).catch((function(e){console.log(e)}))}else dappyRChain.identify({publicKey:void 0}).then((function(t){if(t.identified){if(!t.box)return void _("Need a box for identification, please associate a token box to your account");document.getElementById("root").setAttribute("class","loaded"),s.a.render(r.a.createElement(C,{masterRegistryUri:e,contractId:a,publicKey:t.publicKey,box:t.box,values:void 0,bags:void 0,bagsData:void 0}),document.getElementById("root"))}else _("This dapp needs identification"),console.error("This dapp needs identification")})).catch((function(e){console.log(e),_("This dapp needs identification"),console.error("This dapp needs identification")}))}else _("Version should be 6.0.0");else _("This contract is fungible=true (FT), you need a fungible=false (NFT) contract to use tipboard")})).catch((function(e){console.log(e),_("Unknown error"),console.error("error")}))}}))}]);